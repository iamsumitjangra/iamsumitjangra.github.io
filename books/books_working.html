<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Books - Sumit Kumar</title>
  <meta content="My complete Goodreads library with 366+ books across various genres" name="description">
  <meta content="books, reading, goodreads, library, sumit kumar" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <style>
    .book-card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
      text-decoration: none;
      color: inherit;
    }

    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      text-decoration: none;
      color: inherit;
    }

    .book-cover {
      width: 100%;
      height: 300px;
      object-fit: cover;
      background: #f8f9fa;
    }

    .book-info {
      padding: 20px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .book-title {
      font-size: 16px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 8px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .book-author {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 10px;
      font-style: italic;
    }

    .book-rating {
      color: #f39c12;
      margin-bottom: 5px;
    }

    .book-year {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      margin-bottom: 8px;
      background: #e3f2fd;
      color: #1565c0;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: #149ddd;
    }
  </style>
</head>

<body>
  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">
      <div class="profile">
        <img src="../assets/img/profile-img.png" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="../index.html">Sumit Kumar</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="https://x.com/raas_aal_ghul" target="_blank" class="twitter"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="https://www.linkedin.com/in/iamsumitjangra" class="linkedin"><i class="fa-brands fa-linkedin"></i></a>
        </div>
      </div>

      <nav class="nav-menu">
        <ul>
          <li><a href="../index.html"><i class="bx bx-home"></i> <span>Home</span></a></li>
          <li><a href="../travel-blogs/travel-blogs.html"><i class="bx bx-map"></i> <span>Travel Blogs</span></a></li>
          <li><a href="../paintings/paintings.html"><i class="bx bx-palette"></i> <span>Paintings</span></a></li>
          <li class="active"><a href="books.html"><i class="bx bx-book-open"></i> <span>Books</span></a></li>
          <li><a href="../projects/projects.html"><i class="bx bx-briefcase"></i> <span>Projects</span></a></li>
          <li><a href="../resources/resources.html"><i class="bx bx-book"></i> Resources</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    <!-- ======= Breadcrumbs ======= -->
    <section id="breadcrumbs" class="breadcrumbs">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center">
          <h2><strong>My Library</strong></h2>
          <ol>
            <li><a href="../index.html">Home</a></li>
            <li>My Library</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ======= Books Section ======= -->
    <section id="books" class="portfolio">
      <div class="container">
        <div class="section-title">
          <p class="font-italic">My problem with reading books is that I get distracted... by other books.</p>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="loading">
          <i class="fas fa-spinner"></i>
          Loading your library...
        </div>

        <!-- Books Container -->
        <div id="books-container" class="row" style="display: none;">
          <!-- Books will be dynamically loaded here -->
        </div>
      </div>
    </section>
  </main>

  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/jquery/jquery.min.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Books Loading Script -->
  <script>
    console.log('üöÄ Books page loaded');
    
    let booksData = [];

    // Simple CSV parsing
    function parseCSV(csvText) {
      const lines = csvText.split('\n');
      const headers = lines[0].split(',');
      const books = [];

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        if (!line.trim()) continue;

        // Simple parsing - this might need improvement for complex CSV
        const values = line.split(',');
        if (values.length < headers.length) continue;

        const book = {};
        headers.forEach((header, index) => {
          book[header.trim()] = values[index] ? values[index].replace(/"/g, '').trim() : '';
        });

        // Only include books marked as "read"
        if (book['Exclusive Shelf'] === 'read' && book['Date Read'] && book['Title']) {
          const bookObj = {
            title: book['Title'],
            author: book['Author'] || 'Unknown Author',
            dateRead: book['Date Read'],
            rating: parseFloat(book['Average Rating']) || 0,
            goodreadsId: book['Book Id'],
            isbn: book['ISBN'],
            cover: generateCoverUrl(book['Book Id'], book['ISBN'], book['Title'])
          };
          books.push(bookObj);
        }
      }

      return books;
    }

    // Generate cover URL with local images first, then fallbacks
    function generateCoverUrl(bookId, isbn, title) {
      if (bookId) {
        return `img-books/${bookId}.jpg`;
      }
      // Fallback to external API
      if (isbn) {
        const cleanISBN = isbn.replace(/[^0-9X]/g, '');
        return `https://covers.openlibrary.org/b/isbn/${cleanISBN}-M.jpg`;
      }
      // Final fallback
      return `https://via.placeholder.com/300x400/e3f2fd/1565c0?text=${encodeURIComponent(title.substring(0, 15))}`;
    }

    // Handle image loading errors
    function handleImageError(img) {
      const bookId = img.dataset.bookId;
      const isbn = img.dataset.isbn;
      const title = img.dataset.title;

      if (!img.dataset.fallbackTried) {
        img.dataset.fallbackTried = 'true';
        if (isbn) {
          const cleanISBN = isbn.replace(/[^0-9X]/g, '');
          img.src = `https://covers.openlibrary.org/b/isbn/${cleanISBN}-M.jpg`;
          return;
        }
      }

      // Final fallback
      img.src = `https://via.placeholder.com/300x400/e3f2fd/1565c0?text=${encodeURIComponent(title.substring(0, 15))}`;
    }

    // Load and display books
    function loadBooks() {
      console.log('üîÑ Loading books from CSV...');
      
      fetch('books.csv')
        .then(response => {
          console.log('üìÑ CSV response:', response.status);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(csvText => {
          console.log('üìÑ CSV loaded, length:', csvText.length);
          
          booksData = parseCSV(csvText);
          console.log(`üìö Parsed ${booksData.length} books`);
          
          displayBooks();
        })
        .catch(error => {
          console.error('‚ùå Error loading books:', error);
          document.getElementById('loading').innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            Error loading books: ${error.message}
          `;
        });
    }

    // Display books in the container
    function displayBooks() {
      const container = document.getElementById('books-container');
      const loading = document.getElementById('loading');

      loading.style.display = 'none';
      container.style.display = 'flex';

      container.innerHTML = '';

      booksData.forEach(book => {
        const bookElement = document.createElement('div');
        bookElement.className = 'col-lg-3 col-md-4 col-sm-6 mb-4';
        
        bookElement.innerHTML = `
          <div class="book-card">
            <img src="${book.cover}" 
                 alt="${book.title}" 
                 class="book-cover"
                 data-book-id="${book.goodreadsId}"
                 data-isbn="${book.isbn}"
                 data-title="${book.title}"
                 onerror="handleImageError(this)"
                 loading="lazy">
            <div class="book-info">
              <h3 class="book-title">${book.title}</h3>
              <p class="book-author">${book.author}</p>
              <div class="book-rating">‚òÖ ${book.rating}</div>
              <div>Read: ${book.dateRead}</div>
            </div>
          </div>
        `;

        container.appendChild(bookElement);
      });

      console.log(`‚úÖ Displayed ${booksData.length} books`);
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üìö DOM loaded, starting book loading...');
      loadBooks();
    });
  </script>
</body>
</html>
