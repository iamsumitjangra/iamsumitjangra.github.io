<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Books - Sumit Kumar</title>
  <meta content="My complete Goodreads library with 366+ books across various genres" name="description">
  <meta content="books, reading, goodreads, library, sumit kumar" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="../assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <!-- Custom Navigation Font Styling -->
  <style>
    /* Enhanced Navigation Menu Typography */
    .nav-menu a {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
      font-weight: 500 !important;
      font-size: 15px !important;
      letter-spacing: 0.3px !important;
      text-transform: none !important;
    }

    .nav-menu a span {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
      font-weight: 500 !important;
      letter-spacing: 0.3px !important;
    }

    /* Active menu item styling */
    .nav-menu .active a,
    .nav-menu .active a span {
      font-weight: 600 !important;
    }

    /* Hover effect enhancement */
    .nav-menu a:hover span {
      font-weight: 600 !important;
      transition: font-weight 0.2s ease;
    }



    /* Custom Books Styling */
    .book-card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
      text-decoration: none;
      color: inherit;
    }

    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      text-decoration: none;
      color: inherit;
    }

    .book-link {
      text-decoration: none;
      color: inherit;
      display: block;
      height: 100%;
    }

    .book-link:hover {
      text-decoration: none;
      color: inherit;
    }

    .book-cover {
      width: 100%;
      height: 300px;
      object-fit: cover;
      background: #f8f9fa;
    }

    .book-info {
      padding: 20px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .book-title {
      font-size: 16px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 8px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .book-author {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 10px;
      font-style: italic;
    }

    .book-meta {
      font-size: 12px;
      color: #95a5a6;
      margin-top: auto;
    }

    .book-rating {
      color: #f39c12;
      margin-bottom: 5px;
    }

    .book-year {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      margin-bottom: 8px;
      background: #e3f2fd;
      color: #1565c0;
    }

    .book-pages {
      color: #666;
      font-size: 12px;
      margin-bottom: 5px;
    }

    /* Filter buttons - exact match with paintings page (using template default styles) */
    .portfolio #portfolio-flters {
      padding: 0;
      margin: 0 auto 35px auto;
      list-style: none;
      text-align: center;
      background: #fff;
      border-radius: 50px;
      padding: 2px 15px;
    }

    .portfolio #portfolio-flters li {
      cursor: pointer;
      display: inline-block;
      padding: 10px 15px 8px 15px;
      font-size: 14px;
      font-weight: 600;
      line-height: 1;
      text-transform: uppercase;
      color: #272829;
      margin-bottom: 5px;
      transition: all 0.3s ease-in-out;
    }

    .portfolio #portfolio-flters li:hover,
    .portfolio #portfolio-flters li.filter-active {
      color: #149ddd;
    }

    .portfolio #portfolio-flters li:last-child {
      margin-right: 0;
    }

    /* Loading animation */
    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: #149ddd;
    }

    .loading i {
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .book-cover {
        height: 250px;
      }
      
      .book-info {
        padding: 15px;
      }
      
      .book-title {
        font-size: 15px;
      }
    }
  </style>
</head>

<body>

  <!-- ======= Mobile nav toggle button ======= -->
  <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="../assets/img/profile-img.png" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="../index.html">Sumit Kumar</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="https://x.com/raas_aal_ghul" target="_blank" class="twitter"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="https://www.linkedin.com/in/iamsumitjangra" class="linkedin"><i class="fa-brands fa-linkedin"></i></a>
        </div>
      </div>

      <nav class="nav-menu">
        <ul>
          <li><a href="../index.html"><i class="bx bx-home"></i> <span>Home</span></a></li>
          <li><a href="../travel-blogs/travel-blogs.html"><i class="bx bx-map"></i> <span>Travel Blogs</span></a></li>
          <li><a href="../paintings/paintings.html"><i class="bx bx-palette"></i> <span>Paintings</span></a></li>
          <li class="active"><a href="books.html"><i class="bx bx-book-open"></i> <span>Books</span></a></li>
          <li><a href="../projects/projects.html"><i class="bx bx-briefcase"></i> <span>Projects</span></a></li>
          <li><a href="../resources/resources.html"><i class="bx bx-book"></i> Resources</a></li>
        </ul>
      </nav><!-- .nav-menu -->
      <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

    </div>
  </header>
  <!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section id="breadcrumbs" class="breadcrumbs">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center">
          <h2><strong>My Library</strong></h2>
          <ol>
            <li><a href="../index.html">Home</a></li>
            <li>My Library</li>
          </ol>
        </div>
      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= Books Section ======= -->
    <section id="books" class="portfolio">
      <div class="container">

        <div class="section-title">
          <p class="font-italic">My problem with reading books is that I get distracted... by other books.</p>
          <!-- <p class="text-muted">Explore my complete reading history with <span id="total-books">0</span> books I've finished reading.</p> -->
        </div>

        <!-- Filter Buttons by Year -->
        <div class="row" data-aos="fade-up">
          <div class="col-lg-12 d-flex justify-content-center">
            <ul id="portfolio-flters">
              <li data-filter="*" class="filter-active">All Years (<span id="count-all">0</span>)</li>
              <!-- Year filters will be dynamically generated -->
            </ul>
          </div>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="loading">
          <i class="fas fa-spinner"></i>
          Loading your library...
        </div>

        <!-- Books Container -->
        <div id="books-container" class="row portfolio-container" data-aos="fade-up" data-aos-delay="100" style="display: none;">
          <!-- Books will be dynamically loaded here -->
        </div>

        <!-- No pagination - all books load at once -->

      </div>
    </section>
    <!-- End Books Section -->

  </main><!-- End #main -->

  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/jquery/jquery.min.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>
  <script src="../assets/vendor/waypoints/jquery.waypoints.min.js"></script>
  <script src="../assets/vendor/counterup/counterup.min.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/venobox/venobox.min.js"></script>
  <script src="../assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="../assets/vendor/typed.js/typed.min.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>

  <!-- Books Dynamic Loading Script -->
  <script>
    console.log('üìö Books script loaded');

    let booksData = [];
    let filteredBooks = [];
    let currentFilter = '*';

    // Handle cover image loading errors with fallbacks
    function handleCoverError(img, fallbackUrls) {
      // Get the current failed URL
      const currentUrl = img.src;

      // Find the next fallback URL to try
      let nextUrl = null;

      // If we haven't tried any fallbacks yet, try the first one
      if (!img.dataset.fallbackIndex) {
        img.dataset.fallbackIndex = '0';
        nextUrl = fallbackUrls[0];
      } else {
        // Try the next fallback
        const currentIndex = parseInt(img.dataset.fallbackIndex);
        const nextIndex = currentIndex + 1;

        if (nextIndex < fallbackUrls.length) {
          img.dataset.fallbackIndex = nextIndex.toString();
          nextUrl = fallbackUrls[nextIndex];
        }
      }

      // If we have a next URL to try, use it
      if (nextUrl && nextUrl !== currentUrl) {
        img.src = nextUrl;
      } else {
        // All fallbacks failed, remove the onerror to prevent infinite loops
        img.onerror = null;
        console.warn('All cover fallbacks failed for:', img.alt);
      }
    }

    // Robust CSV parsing function for Goodreads format
    function parseCSV(csvText) {
      try {
        const lines = csvText.split('\n');
        if (lines.length < 2) {
          console.error('CSV has insufficient lines');
          return [];
        }

        // Parse headers using the robust parser
        const headers = parseCSVLine(lines[0]);
        console.log('üìã CSV Headers found:', headers.length, 'columns');
        console.log('üìã Headers:', headers.slice(0, 5), '...');

        const books = [];
        let successCount = 0;
        let errorCount = 0;

        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;

          try {
            const values = parseCSVLine(line);

            if (values.length < 10) { // Skip rows with too few columns
              continue;
            }

            const book = {};
            headers.forEach((header, index) => {
              book[header] = values[index] || '';
            });

            // Convert to our book object format
            const bookObj = convertCSVRowToBook(book);
            if (bookObj && bookObj.title) {
              books.push(bookObj);
              successCount++;
            }
          } catch (error) {
            errorCount++;
            if (errorCount < 5) { // Only log first few errors
              console.warn(`Error parsing line ${i}:`, error.message);
            }
            continue;
          }
        }

        console.log(`‚úÖ Successfully parsed ${successCount} books, ${errorCount} errors`);
        return books;
      } catch (error) {
        console.error('Fatal CSV parsing error:', error);
        return [];
      }
    }

    // Parse a single CSV line with proper quote handling
    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      let i = 0;

      while (i < line.length) {
        const char = line[i];

        if (char === '"') {
          if (inQuotes && line[i + 1] === '"') {
            // Escaped quote
            current += '"';
            i += 2;
            continue;
          } else {
            // Toggle quote state
            inQuotes = !inQuotes;
            i++;
            continue;
          }
        }

        if (char === ',' && !inQuotes) {
          result.push(current.trim());
          current = '';
        } else {
          current += char;
        }

        i++;
      }

      result.push(current.trim());
      return result;
    }

    // Convert CSV row to book object - only for books that have been read
    function convertCSVRowToBook(csvRow) {
      try {
        const title = csvRow['Title'] || '';
        const dateRead = csvRow['Date Read'] || '';
        const exclusiveShelf = csvRow['Exclusive Shelf'] || '';

        // Only include books that are marked as "read" AND have a Date Read
        if (!title || !dateRead || exclusiveShelf !== 'read') return null;

        // Generate book ID from title
        const id = title.toLowerCase()
          .replace(/[^a-z0-9\s]/g, '')
          .replace(/\s+/g, '-')
          .substring(0, 50);

        // Extract year from Date Read
        const getYearFromDate = (dateStr) => {
          if (!dateStr) return null;
          try {
            // Handle different date formats (YYYY/MM/DD, YYYY-MM-DD, etc.)
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) {
              // Try to extract year from string if date parsing fails
              const yearMatch = dateStr.match(/(\d{4})/);
              return yearMatch ? parseInt(yearMatch[1]) : null;
            }
            return date.getFullYear();
          } catch (e) {
            return null;
          }
        };

        // Format date for display
        const formatDate = (dateStr) => {
          if (!dateStr) return '';
          try {
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return dateStr;
            return date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            });
          } catch (e) {
            return dateStr;
          }
        };

        // Generate cover URL - prioritize local static images with external fallbacks
        const generateCoverUrl = (bookId, isbn, title) => {
          // First try local static image
          const filename = bookId ? `${bookId}.jpg` : generateFilenameFromTitle(title);
          return `img-books/${filename}`;
        };

        // Generate filename from title (matches Python script logic)
        const generateFilenameFromTitle = (title) => {
          const cleanTitle = title.toLowerCase()
            .replace(/[^a-z0-9\s]/g, '')
            .replace(/\s+/g, '-')
            .substring(0, 50);
          return `${cleanTitle}.jpg`;
        };

        // Generate external fallback URLs for when local images fail
        const generateExternalFallbacks = (bookId, isbn, title) => {
          const fallbacks = [];

          // Try Open Library with ISBN
          if (isbn && isbn.length >= 10) {
            const cleanISBN = isbn.replace(/[^0-9X]/g, '');
            fallbacks.push(`https://covers.openlibrary.org/b/isbn/${cleanISBN}-L.jpg`);
            fallbacks.push(`https://covers.openlibrary.org/b/isbn/${cleanISBN}-M.jpg`);
          }

          // Try Google Books API
          if (isbn && isbn.length >= 10) {
            const cleanISBN = isbn.replace(/[^0-9X]/g, '');
            fallbacks.push(`https://books.google.com/books/content?id=&printsec=frontcover&img=1&zoom=1&imgtk=${cleanISBN}`);
          }

          // Final fallback to placeholder with title
          const titleText = title.substring(0, 15).replace(/[^a-zA-Z0-9\s]/g, '');
          fallbacks.push(`https://via.placeholder.com/300x400/e3f2fd/1565c0?text=${encodeURIComponent(titleText)}`);

          return fallbacks;
        };

        // Parse pages
        const parsePages = (pagesStr) => {
          if (!pagesStr || pagesStr === '') return null;
          const pages = parseInt(pagesStr);
          return isNaN(pages) ? null : pages;
        };

        // Parse rating
        const parseRating = (ratingStr) => {
          if (!ratingStr) return 0;
          const rating = parseFloat(ratingStr);
          return isNaN(rating) ? 0 : rating;
        };

        const readYear = getYearFromDate(dateRead);
        if (!readYear) return null; // Skip books without valid read year

        // Clean ISBN - handle the ="..." format from Goodreads
        const cleanISBN = (isbn) => {
          if (!isbn) return '';
          return isbn.replace(/^="?|"?$/g, '').trim();
        };

        const bookId = csvRow['Book Id'] || '';
        const isbn = cleanISBN(csvRow['ISBN']);

        return {
          id: id,
          title: title,
          author: csvRow['Author'] || 'Unknown Author',
          isbn: isbn,
          pages: parsePages(csvRow['Number of Pages']),
          rating: parseRating(csvRow['Average Rating']),
          dateRead: formatDate(dateRead),
          readYear: readYear,
          cover: generateCoverUrl(bookId, isbn, title),
          goodreadsId: bookId,
          goodreadsUrl: bookId ? `https://www.goodreads.com/book/show/${bookId}` : null
        };
      } catch (error) {
        console.warn('Error converting CSV row to book:', error, csvRow);
        return null;
      }
    }

    // Simplified CSV loading function
    function loadBooksFromCSV() {
      console.log('üîÑ Starting to load CSV...');

      fetch('books.csv')
        .then(function(response) {
          console.log('ÔøΩ CSV response status:', response.status);
          if (!response.ok) {
            throw new Error('HTTP ' + response.status);
          }
          return response.text();
        })
        .then(function(csvText) {
          console.log('üìÑ CSV loaded, length:', csvText.length);

          booksData = parseCSV(csvText);
          filteredBooks = booksData.slice();

          console.log('üìö Parsed', booksData.length, 'books');

          if (booksData.length === 0) {
            throw new Error('No books found in CSV file');
          }

          // Load books and setup filters
          loadAllBooks();
          setupFilters();
          updateCounts();
        })
        .catch(function(error) {
          console.error('‚ùå Error loading CSV:', error);
          const loadingElement = document.getElementById('loading');
          loadingElement.innerHTML =
            '<i class="fas fa-exclamation-triangle"></i> Error loading books: ' + error.message;
          loadingElement.style.color = '#dc3545';
        });
    }

    // Simple CSV parser
    function parseCSVSimple(csvText) {
      const lines = csvText.split('\n');
      const books = [];

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        if (!line.includes(',read,')) continue;

        const parts = line.split(',');
        if (parts.length < 15) continue;

        const bookId = parts[0];
        const title = parts[1].replace(/"/g, '');
        const author = parts[2].replace(/"/g, '');
        const rating = parseFloat(parts[8]) || 0;
        const dateRead = parts[14];

        if (title && dateRead) {
          const readYear = new Date(dateRead).getFullYear() || 2024;

          books.push({
            id: bookId,
            title: title,
            author: author,
            rating: rating,
            dateRead: dateRead,
            readYear: readYear,
            cover: 'img-books/' + bookId + '.jpg',
            goodreadsId: bookId,
            goodreadsUrl: bookId ? 'https://www.goodreads.com/book/show/' + bookId : null
          });
        }
      }

      return books;
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ DOM Content Loaded - Starting initialization');

      // Initialize AOS (skip if not available)
      try {
        if (typeof AOS !== 'undefined') {
          AOS.init();
          console.log('‚úÖ AOS initialized');
        } else {
          console.log('‚ö†Ô∏è AOS not available, skipping');
        }
      } catch (e) {
        console.log('‚ö†Ô∏è AOS initialization failed:', e);
      }

      // Load books with a simple approach
      setTimeout(function() {
        loadBooksFromCSV();
      }, 1000);
    });



    function loadAllBooks() {
      const container = document.getElementById('books-container');
      const loading = document.getElementById('loading');

      // Hide loading, show container
      loading.style.display = 'none';
      container.style.display = 'flex';

      // Clear existing books
      container.innerHTML = '';

      // Generate HTML for all filtered books
      filteredBooks.forEach(book => {
        const bookElement = createBookElement(book);
        container.appendChild(bookElement);
      });

      console.log(`üìö Loaded ${filteredBooks.length} books`);

      // Initialize isotope after loading
      if (typeof $.fn.isotope !== 'undefined') {
        $(container).isotope('reloadItems').isotope();
      }
    }

    function createBookElement(book) {
      const div = document.createElement('div');
      div.className = `col-lg-3 col-md-4 col-sm-6 portfolio-item year-${book.readYear}`;

      // Simple fallback for image errors
      const onErrorHandler = `this.src='https://via.placeholder.com/300x400/e3f2fd/1565c0?text=${encodeURIComponent(book.title.substring(0, 15))}'`;

      // Create the book card content
      const bookCardContent = `
        <img src="${book.cover}" alt="${book.title}" class="book-cover"
             onerror="${onErrorHandler}"
             loading="lazy">
        <div class="book-info">
          <div class="book-year">${book.readYear}</div>
          <h3 class="book-title">${book.title}</h3>
          <p class="book-author">${book.author}</p>
          <div class="book-rating">‚òÖ ${book.rating}</div>
          ${book.pages ? `<div class="book-pages">${book.pages} pages</div>` : ''}
          <div class="book-meta">
            <div>Read: ${book.dateRead}</div>
          </div>
        </div>
      `;

      // Wrap in link if Goodreads URL is available
      if (book.goodreadsUrl) {
        div.innerHTML = `
          <a href="${book.goodreadsUrl}" target="_blank" rel="noopener noreferrer" class="book-link">
            <div class="book-card">
              ${bookCardContent}
            </div>
          </a>
        `;
      } else {
        div.innerHTML = `
          <div class="book-card">
            ${bookCardContent}
          </div>
        `;
      }

      return div;
    }

    function setupFilters() {
      // Generate year filters dynamically
      const years = [...new Set(booksData.map(book => book.readYear))].sort((a, b) => b - a);
      const filtersContainer = document.getElementById('portfolio-flters');

      // Clear existing filters except "All Years"
      const allButton = filtersContainer.querySelector('[data-filter="*"]');
      filtersContainer.innerHTML = '';
      filtersContainer.appendChild(allButton);

      // Add year filters
      years.forEach(year => {
        const yearCount = booksData.filter(book => book.readYear === year).length;
        const li = document.createElement('li');
        li.setAttribute('data-filter', `.year-${year}`);
        li.innerHTML = `${year} (<span id="count-${year}">${yearCount}</span>)`;
        filtersContainer.appendChild(li);
      });

      // Setup click handlers for all filter buttons
      const filterButtons = document.querySelectorAll('#portfolio-flters li');
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all buttons
          filterButtons.forEach(btn => btn.classList.remove('filter-active'));
          // Add active class to clicked button
          this.classList.add('filter-active');

          // Get filter value
          const filterValue = this.getAttribute('data-filter');
          currentFilter = filterValue;

          // Filter books
          if (filterValue === '*') {
            filteredBooks = [...booksData];
          } else {
            const year = parseInt(filterValue.replace('.year-', ''));
            filteredBooks = booksData.filter(book => book.readYear === year);
          }

          // Reload all filtered books
          loadAllBooks();

          console.log(`üîç Filtered to ${filteredBooks.length} books (${filterValue})`);
        });
      });
    }

    function updateCounts() {
      // Update total count
      document.getElementById('count-all').textContent = booksData.length;
      document.getElementById('total-books').textContent = booksData.length;

      // Update year counts (already handled in setupFilters)
      console.log(`üìä Total books read: ${booksData.length}`);
    }

    // No pagination - all books load at once
  </script>

</body>

</html>
